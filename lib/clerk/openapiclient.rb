# Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

# typed: false
# frozen_string_literal: true

require 'faraday'
require 'faraday/multipart'
require 'faraday/retry'
require_relative 'sdk_hooks/hooks'
require_relative 'utils/retries'

module Clerk
  

  class OpenAPIClient
    

    attr_accessor :miscellaneous, :jwks, :clients, :email_addresses, :phone_numbers, :sessions, :email_sms_templates, :email_and_sms_templates, :templates, :users, :invitations, :organization_invitations, :allowlist_identifiers, :blocklist_identifiers, :beta_features, :actor_tokens, :domains, :instance_settings, :webhooks, :jwt_templates, :machines, :organizations, :organization_roles, :organization_memberships, :organization_domains, :proxy_checks, :redirect_urls, :sign_in_tokens, :sign_ups, :oauth_applications, :saml_connections, :testing_tokens, :waitlist_entries, :billing, :organization_permissions, :role_sets, :api_keys, :m2m, :oauth_access_tokens

    # Instantiates the SDK, configuring it with the provided parameters.
    #
    # @param client [Faraday::Connection, nil] The faraday HTTP client to use for all operations
    # @param retry_config [::Clerk::Utils::RetryConfig, nil] The retry configuration to use for all operations
    # @param timeout_ms [Integer, nil] Request timeout in milliseconds for all operations
    # @param security [Models::Components::Security, nil] The security details required for authentication
    # @param security_source [Proc{|| Models::Components::Security, nil}] A function that returns security details required for authentication
    # @param server_idx [Integer, nil] The index of the server to use for all operations
    # @param server_url [String, nil] The server URL to use for all operations
    # @param url_params [Hash{Symbol => String}, nil] Parameters to optionally template the server URL with
    def initialize(client: nil, retry_config: nil, timeout_ms: nil, bearer_auth: nil, security_source: nil, server_idx: nil, server_url: nil, url_params: nil)

      connection_options = {
        request: {
          params_encoder: Faraday::FlatParamsEncoder
        }
      }
      connection_options[:request][:timeout] = (timeout_ms.to_f / 1000) unless timeout_ms.nil?

      client ||= Faraday.new(**connection_options) do |f|
        f.request :multipart, { flat_encode: true }
        # f.response :logger, nil, { headers: true, bodies: true, errors: true }
      end
      
      if !server_url.nil?
        if !url_params.nil?
          server_url = Utils.template_url(server_url, url_params)
        end
      end

      server_idx = 0 if server_idx.nil?
      hooks = SDKHooks::Hooks.new
      @sdk_configuration = SDKConfiguration.new(
        client,
        hooks,
        retry_config,
        timeout_ms,
        bearer_auth,
        security_source,
        server_url,
        server_idx
      )
      @sdk_configuration = hooks.sdk_init(config: @sdk_configuration)
      init_sdks
    end

    
    def init_sdks
      @miscellaneous = Miscellaneous.new(@sdk_configuration)
      @jwks = Jwks.new(@sdk_configuration)
      @clients = Clients.new(@sdk_configuration)
      @email_addresses = EmailAddresses.new(@sdk_configuration)
      @phone_numbers = PhoneNumbers.new(@sdk_configuration)
      @sessions = Sessions.new(@sdk_configuration)
      @email_sms_templates = EmailSMSTemplates.new(@sdk_configuration)
      @email_and_sms_templates = EmailAndSmsTemplates.new(@sdk_configuration)
      @templates = Templates.new(@sdk_configuration)
      @users = Users.new(@sdk_configuration)
      @invitations = Invitations.new(@sdk_configuration)
      @organization_invitations = OrganizationInvitations.new(@sdk_configuration)
      @allowlist_identifiers = AllowlistIdentifiers.new(@sdk_configuration)
      @blocklist_identifiers = BlocklistIdentifiers.new(@sdk_configuration)
      @beta_features = BetaFeatures.new(@sdk_configuration)
      @actor_tokens = ActorTokens.new(@sdk_configuration)
      @domains = Domains.new(@sdk_configuration)
      @instance_settings = InstanceSettings.new(@sdk_configuration)
      @webhooks = Webhooks.new(@sdk_configuration)
      @jwt_templates = JwtTemplates.new(@sdk_configuration)
      @machines = Machines.new(@sdk_configuration)
      @organizations = Organizations.new(@sdk_configuration)
      @organization_roles = OrganizationRoles.new(@sdk_configuration)
      @organization_memberships = OrganizationMemberships.new(@sdk_configuration)
      @organization_domains = OrganizationDomains.new(@sdk_configuration)
      @proxy_checks = ProxyChecks.new(@sdk_configuration)
      @redirect_urls = RedirectUrls.new(@sdk_configuration)
      @sign_in_tokens = SignInTokens.new(@sdk_configuration)
      @sign_ups = SignUps.new(@sdk_configuration)
      @oauth_applications = OauthApplications.new(@sdk_configuration)
      @saml_connections = SamlConnections.new(@sdk_configuration)
      @testing_tokens = TestingTokens.new(@sdk_configuration)
      @waitlist_entries = WaitlistEntries.new(@sdk_configuration)
      @billing = Billing.new(@sdk_configuration)
      @organization_permissions = OrganizationPermissions.new(@sdk_configuration)
      @role_sets = RoleSets.new(@sdk_configuration)
      @api_keys = APIKeys.new(@sdk_configuration)
      @m2m = M2m.new(@sdk_configuration)
      @oauth_access_tokens = OauthAccessTokens.new(@sdk_configuration)
    end

    
    def get_url(base_url:, url_variables: nil)
      sd_base_url, sd_options = @sdk_configuration.get_server_details

      if base_url.nil?
        base_url = sd_base_url
      end

      if url_variables.nil?
        url_variables = sd_options
      end

      return Utils.template_url base_url, url_variables
    end
  end
end
